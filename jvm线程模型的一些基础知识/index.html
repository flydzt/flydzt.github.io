<!doctype html>
<html lang="en">
    <head>
		
        <meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="description" content="解决一类问题而不是一个问题">
        <link rel="shortcut icon" href="/images/hhh.jpg"/>
        <link rel="canonical" href="http://guolinn.com/">
        <link rel="alternate" type="application/rss+xml" title="flydzt" href="">
        <title>jvm线程模型的一些基础知识 | flydzt</title>
        <meta name="description" content="{{meta_description}}">

        <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="/styles/crisp.css">
        <meta name="HandheldFriendly" content="True" />
        <meta name="MobileOptimized" content="320" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

    <meta name="generator" content="Hexo 4.2.0"></head>
    
		<body class="post-template">
	

        <header id="header">
            <a id="logo" href="/"><img src="/images/hhh.jpg" alt="flydzt" /></a>
            <h1><a href="/">flydzt</a></h1>
            <p></p>
            <div id="follow-icons">
          <a href="http://github.com/flydzt" target="_blank" rel="noopener"><i class="fa fa-github-square fa-2x"></i></a>
          </div>
<h6><a href="/about">About</a></h6>
        </header>

        <main id="content">
        

<article class="post">
  四月 19, 2020
  
    <span class="taglist">  &middot; 
    
    
      <a href='/tags/java/'>java</a> 
    
      <a href='/tags/thread/'>thread</a> 
    
      <a href='/tags/os/'>os</a> 
    
    </span>
  

  <h1 class="post-title">jvm线程模型的一些基础知识</h1>
  <section class="post-content article-entry">
    <h2 id="进程和线程"><a href="#进程和线程" class="headerlink" title="进程和线程"></a>进程和线程</h2><p>进程是资源的集合,线程是执行的实体.</p>
<p>进程由fork系统调用创建,形成层次结构,通常新建进程马上会执行新的命令,所以有copy-on-write的优化.</p>
<p>线程则由pthread_create创建,共享进程内的资源.程序计数器和栈是独立的.程序计数器表明当前执行到哪里,栈则是执行的历史.</p>
<h2 id="用户线程和内核线程"><a href="#用户线程和内核线程" class="headerlink" title="用户线程和内核线程"></a>用户线程和内核线程</h2><p>操作系统的线程概念可以实现在用户空间或者内核空间,也可以是混合的.linux以轻量级进程来实现线程.</p>
<p>如果实现在用户空间,用户态的线程切换不需要陷入内核,所以切换非常快.在web领域,绝大部分时间都是在io.那么执行一个阻塞操作,然后进程调度切换线程即可.进程来管理对应的线程表以及对应的调度.</p>
<p>但由于是内核在调度整个进程,那对于用户线程来说,内核的一些操作都是粗粒度的,是应用于整个进程的.例如如果进程中某个线程触发了缺页,整个进程都会被挂起,尽管有的线程可以继续运行.</p>
<p>内核线程则由内核来管理线程表.切换线程一般发生在,系统调用阻塞了,自动让出,或者运行了足够久被调度.和用户态线程不一样的在于:能阻塞线程的函数都是系统调用,这样内核才能去切换线程,性能会受到影响.优点则是:内核操作的粒度是线程,内核清楚的知道哪些线程是阻塞.如果发生缺页,则不影响别的线程的执行.如果是用户态的线程,内核不知道进程内部线程的情况,只能整个挂起.</p>
<p>混合实现也是可以的.采用多路复用的形式.进程先创建内核线程,内核线程再管理用户态线程.</p>
<h2 id="jvm线程"><a href="#jvm线程" class="headerlink" title="jvm线程"></a>jvm线程</h2><p>jvm的实现和操作系统有关.在windows和linux上,jvm线程和底层操作系统的线程都是一对一的关系.</p>
<p>所以在编程时,需要明确一个调用是同步的还是异步的,由我们来处理这个逻辑.如果实现为协程的话,调用都可以是阻塞的.阻塞调用会发生线程切换.这个阻塞是虚拟机提供的功能,而不是操作系统.那我们所有操作都可以是同步的,可以做到connection per thread.</p>
<p>netty的线程模型的实现是混合线程的感觉.一个线程在select轮询,但是它又关注任务队列里是否有任务即将到期需要执行.所以select是有时限的.在执行对应任务的时候,又是不支持抢占式的调度,只能等任务执行完毕.所以在使用netty的时候,一些耗时操作直接提交给netty是有风险的.</p>
<h2 id="线程池"><a href="#线程池" class="headerlink" title="线程池"></a>线程池</h2><p>使用线程池的情况下,估计好任务的瓶颈,cpu和io的时间占比.做好微服务拆分,配合上容器,能充分利用系统资源.</p>

  </section>
  <footer class="post-footer">
    <!--
    <section class="author">
      <h4>flydzt</h4>
      <p></p>
    </section>
    -->
  </footer>
</article>

<nav class="pagination" role="pagination">
    
    <span class="page-number">•</span>
    
    <a class="older-posts" href="/aqs%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/">
        <!--aqs基本原理--> next →
    </a>
    
</nav>


        </main>
        <footer id="footer">
            <section id="footer-message">&copy; 2020 flydzt. </section>
        </footer>
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>


